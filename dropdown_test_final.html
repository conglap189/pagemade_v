<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Navbar Dropdown Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-50 dark:bg-gray-900">
    <!-- Test Navbar with User Dropdown -->
    <header id="mainNavbar" class="top-0 left-0 z-[99999] flex w-full items-center transition-all duration-500 ease-in-out bg-transparent dark:bg-transparent border-b border-slate-200/50 dark:border-slate-700/50 at-top" style="position: fixed">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="relative flex items-center justify-between h-16">
                <!-- Logo -->
                <div class="flex items-center space-x-3">
                    <a href="#" class="flex items-center space-x-3 group">
                        <img src="https://via.placeholder.com/64x64.png?text=Logo" alt="PageMade Logo" class="w-16 h-16 object-contain bg-transparent">
                    </a>
                </div>

                <!-- Desktop Navigation -->
                <nav class="hidden md:flex items-center space-x-10">
                    <a href="#" class="px-4 py-2 text-slate-600 dark:text-slate-300 hover:text-blue-600 dark:hover:text-blue-400 font-medium transition-colors duration-200 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800">
                        Dashboard
                    </a>
                    <a href="#" class="px-4 py-2 text-slate-600 dark:text-slate-300 hover:text-blue-600 dark:hover:text-blue-400 font-medium transition-colors duration-200 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800">
                        New Site
                    </a>
                </nav>

                <!-- Right Side -->
                <div class="flex items-center space-x-4 pr-4 lg:pr-0">
                    <!-- Dark Mode Toggle -->
                    <button id="darkModeToggle" class="flex items-center justify-center text-black rounded-full cursor-pointer bg-gray-200 dark:bg-gray-800 h-9 w-9 dark:text-white transition-all duration-300 hover:bg-gray-300 dark:hover:bg-gray-700">
                        <i class="fas fa-moon dark:hidden"></i>
                        <i class="fas fa-sun hidden dark:block"></i>
                    </button>

                    <!-- User Menu -->
                    <div class="navbar-user-menu relative z-[9999]" id="userMenu">
                        <button onclick="toggleUserMenu()" class="flex items-center space-x-3 p-2 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-all duration-200">
                            <div class="w-8 h-8 bg-gradient-to-br from-green-400 to-blue-500 rounded-full flex items-center justify-center">
                                <span class="text-white text-sm font-bold navbar-user-initial">T</span>
                            </div>
                            <div class="hidden sm:block text-left">
                                <p class="text-sm font-medium text-slate-700 dark:text-slate-200 navbar-user-name">Test User</p>
                                <p class="text-xs text-slate-500 dark:text-slate-400">test@example.com</p>
                            </div>
                            <i class="fas fa-chevron-down text-xs transition-transform duration-200" id="dropdownChevron"></i>
                        </button>
                        
                        <!-- Dropdown Menu -->
                        <div id="userDropdown" class="dropdown-menu absolute right-0 mt-2 w-64 bg-white dark:bg-slate-800 rounded-xl shadow-xl border border-slate-200 dark:border-slate-700 py-2 z-[99999] hidden opacity-0 invisible transform scale-95 transition-all duration-200 ease-out">
                            <div class="px-4 py-3 border-b border-slate-200 dark:border-slate-700">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-gradient-to-br from-green-400 to-blue-500 rounded-full flex items-center justify-center">
                                        <span class="text-white text-sm font-bold navbar-user-initial">T</span>
                                    </div>
                                    <div>
                                        <p class="text-sm font-medium text-slate-700 dark:text-slate-200 navbar-user-name">Test User</p>
                                        <p class="text-xs text-slate-500 dark:text-slate-400">test@example.com</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="py-2">
                                <a href="#" class="flex items-center space-x-3 px-4 py-2 text-sm text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors duration-200">
                                    <i class="fas fa-th-large w-4"></i>
                                    <span>Dashboard</span>
                                </a>
                                
                                <a href="#" class="flex items-center space-x-3 px-4 py-2 text-sm text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors duration-200">
                                    <i class="fas fa-user-circle w-4"></i>
                                    <span>Profile</span>
                                </a>
                                
                                <a href="#" class="flex items-center space-x-3 px-4 py-2 text-sm text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors duration-200">
                                    <i class="fas fa-users-cog w-4"></i>
                                    <span>Admin Panel</span>
                                </a>
                                
                                <div class="border-t border-slate-200 dark:border-slate-700 my-2"></div>
                                
                                <a href="#" class="flex items-center space-x-3 px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors duration-200">
                                    <i class="fas fa-sign-out-alt w-4"></i>
                                    <span>Logout</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="min-h-screen pt-20">
        <div class="container mx-auto px-4 py-8">
            <div class="max-w-4xl mx-auto">
                <h1 class="text-3xl font-bold text-slate-800 dark:text-white mb-6">Navbar Dropdown Test</h1>
                
                <div class="bg-white dark:bg-slate-800 rounded-lg shadow-lg p-6 mb-6">
                    <h2 class="text-xl font-semibold text-slate-800 dark:text-white mb-4">âœ… What to Test</h2>
                    <div class="space-y-3">
                        <div class="flex items-start space-x-3">
                            <div class="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                                <i class="fas fa-check text-white text-xs"></i>
                            </div>
                            <div>
                                <p class="text-slate-700 dark:text-slate-300 font-medium">Smooth Opening</p>
                                <p class="text-sm text-slate-600 dark:text-slate-400">Click the user profile area - dropdown should open smoothly without layout shift</p>
                            </div>
                        </div>
                        
                        <div class="flex items-start space-x-3">
                            <div class="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                                <i class="fas fa-check text-white text-xs"></i>
                            </div>
                            <div>
                                <p class="text-slate-700 dark:text-slate-300 font-medium">Smooth Closing</p>
                                <p class="text-sm text-slate-600 dark:text-slate-400">Click outside - dropdown should close smoothly</p>
                            </div>
                        </div>
                        
                        <div class="flex items-start space-x-3">
                            <div class="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                                <i class="fas fa-check text-white text-xs"></i>
                            </div>
                            <div>
                                <p class="text-slate-700 dark:text-slate-300 font-medium">Chevron Animation</p>
                                <p class="text-sm text-slate-600 dark:text-slate-400">Arrow should rotate 180Â° when dropdown opens</p>
                            </div>
                        </div>
                        
                        <div class="flex items-start space-x-3">
                            <div class="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                                <i class="fas fa-check text-white text-xs"></i>
                            </div>
                            <div>
                                <p class="text-slate-700 dark:text-slate-300 font-medium">No "Jerky" Behavior</p>
                                <p class="text-sm text-slate-600 dark:text-slate-400">Components shouldn't bunch in corner or reload</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-6">
                    <h3 class="text-lg font-semibold text-blue-800 dark:text-blue-300 mb-3">ðŸ”§ Technical Implementation</h3>
                    <ul class="space-y-2 text-sm text-blue-700 dark:text-blue-400">
                        <li>â€¢ Pure JavaScript (no Alpine.js to avoid conflicts)</li>
                        <li>â€¢ Hardware acceleration with transform3d</li>
                        <li>â€¢ Proper z-index stacking</li>
                        <li>â€¢ Smooth scale and opacity transitions</li>
                        <li>â€¢ Click-outside-to-close functionality</li>
                        <li>â€¢ Null checks for authenticated vs non-authenticated users</li>
                    </ul>
                </div>
            </div>
        </div>
    </main>

    <style>
        /* Navbar smooth transitions */
        #mainNavbar.at-top {
            background-color: transparent !important;
            backdrop-filter: none !important;
        }

        #mainNavbar.scrolled {
            background-color: rgba(255, 255, 255, 0.8) !important;
            backdrop-filter: blur(16px) !important;
        }

        .dark #mainNavbar.scrolled {
            background-color: rgba(17, 24, 39, 0.8) !important;
        }

        /* Ensure navbar always fixed and visible */
        #mainNavbar {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            z-index: 99999 !important;
        }

        /* Add padding-top to main content to prevent overlap */
        body {
            padding-top: 80px !important;
        }

        main {
            padding-top: 0 !important;
        }

        /* User dropdown optimizations */
        .navbar-user-menu {
            /* Prevent layout shift */
            contain: layout style;
        }

        .dropdown-menu {
            /* Hardware acceleration for smooth animations */
            transform: translateZ(0);
            will-change: transform, opacity;
            backface-visibility: hidden;
            /* Prevent layout shift during animation */
            position: absolute;
            /* Ensure proper stacking */
            isolation: isolate;
        }

        .dropdown-menu.visible {
            /* Final state for smooth animation */
            transform: translateZ(0) scale(1);
        }

        .dropdown-menu.invisible {
            /* Hidden state */
            transform: translateZ(0) scale(0.95);
        }

        /* Chevron animation */
        #dropdownChevron {
            transition: transform 0.2s ease-in-out;
            transform-origin: center;
        }
    </style>

    <script>
        // Sticky Navbar effect
        const navbar = document.getElementById('mainNavbar');
        let scrollTimer = null;
        let isScrolling = false;
        
        function updateNavbar() {
            if (window.scrollY >= 80) {
                navbar.classList.add('scrolled');
                navbar.classList.remove('at-top');
            } else {
                navbar.classList.add('at-top');
                navbar.classList.remove('scrolled');
            }
            isScrolling = false;
        }
        
        function throttledScroll() {
            if (!isScrolling) {
                isScrolling = true;
                requestAnimationFrame(updateNavbar);
            }
        }
        
        window.addEventListener('scroll', throttledScroll, { passive: true });
        updateNavbar();

        // Dark mode toggle
        const darkModeToggle = document.getElementById('darkModeToggle');
        const html = document.documentElement;
        const currentTheme = localStorage.getItem('theme') || 'light';
        html.classList.toggle('dark', currentTheme === 'dark');
        darkModeToggle.addEventListener('click', () => {
            html.classList.toggle('dark');
            const newTheme = html.classList.contains('dark') ? 'dark' : 'light';
            localStorage.setItem('theme', newTheme);
        });

        // Pure JavaScript User Dropdown - Smooth without layout shift
        // Only initialize if user dropdown exists (authenticated users)
        const userDropdown = document.getElementById('userDropdown');
        const dropdownChevron = document.getElementById('dropdownChevron');
        
        if (userDropdown && dropdownChevron) {
            let userMenuOpen = false;
            
            function toggleUserMenu() {
                userMenuOpen = !userMenuOpen;
                
                if (userMenuOpen) {
                    // Open dropdown with smooth animation
                    userDropdown.classList.remove('hidden');
                    // Force a reflow to ensure the hidden class is removed before adding transitions
                    userDropdown.offsetHeight;
                    userDropdown.classList.remove('invisible', 'opacity-0', 'scale-95');
                    userDropdown.classList.add('visible', 'opacity-100', 'scale-100');
                    dropdownChevron.style.transform = 'rotate(180deg)';
                    
                    // Add click outside listener
                    setTimeout(() => {
                        document.addEventListener('click', handleClickOutside);
                    }, 100);
                } else {
                    // Close dropdown with smooth animation
                    userDropdown.classList.remove('visible', 'opacity-100', 'scale-100');
                    userDropdown.classList.add('invisible', 'opacity-0', 'scale-95');
                    dropdownChevron.style.transform = 'rotate(0deg)';
                    
                    // Remove click outside listener
                    document.removeEventListener('click', handleClickOutside);
                    
                    // Add hidden class after transition completes
                    setTimeout(() => {
                        if (!userMenuOpen) {
                            userDropdown.classList.add('hidden');
                        }
                    }, 200);
                }
            }
            
            function handleClickOutside(event) {
                const userMenu = document.getElementById('userMenu');
                if (userMenu && !userMenu.contains(event.target)) {
                    if (userMenuOpen) {
                        toggleUserMenu();
                    }
                }
            }
            
            // Prevent dropdown from closing when clicking inside
            userDropdown.addEventListener('click', (e) => {
                e.stopPropagation();
            });
        }
    </script>
</body>
</html>